# GitHubì˜ ì•¡ì…˜ íƒ­ì—ì„œ í‘œì‹œë˜ëŠ” ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„
name: Build and Test

on:
  # develop ë¸Œëœì¹˜ì— push ë‚˜ pull request ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚¬ì„ë•Œ í•´ë‹¹ workflowë¥¼ íŠ¸ë¦¬ê±°
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]

jobs:
  build:
    runs-on: macos-15
    env:
      PROJECT_DIR: Meomun
      SCHEME_NAME: Meomun
    steps:
    # repository ì²´í¬ì•„ì›ƒ(ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ ì‹¤í–‰ í™˜ê²½ìœ¼ë¡œ ê°€ì ¸ì˜´)
    - uses: actions/checkout@v4

   # Secrets.xcconfig ìƒì„±
    - name: Create Secrets.xcconfig ğŸ”
      run: |
        cat <<EOF > Meomun/Secrets.xcconfig
        NAVER_API_KEY=${{ secrets.NAVER_API_KEY }}
        EOF
        
    # í•´ë‹¹ ê°€ìƒ ë¨¸ì‹  í™˜ê²½ì—ì„œì˜ ê°€ìš© Xcode ë²„ì „ì„ ì¶œë ¥
    - name: List available Xcode versions
      run: ls /Applications | grep Xcode

    # í˜„ì¬ Xcode ë²„ì „ ì¶œë ¥
    - name: Show current version of Xcode
      run: xcodebuild -version

    # Xcode ë²„ì „ ì§ì ‘ ì„¤ì • í›„ í™•ì¸
    - name: Set up Xcode version
      run: |
        sudo xcode-select -s /Applications/Xcode_26.1.app/Contents/Developer
        xcodebuild -version

    - name: Build the project ğŸ› 
      run: |
        # í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
        cd "$PROJECT_DIR"
        
        # .xcworkspace ë˜ëŠ” .xcodeproj íŒŒì¼ ì°¾ê¸°
        if [ -d *.xcworkspace ] 2>/dev/null; then
          filetype_parameter="workspace"
          file_to_build=$(ls -d *.xcworkspace | head -1)
        elif [ -d *.xcodeproj ] 2>/dev/null; then
          filetype_parameter="project"
          file_to_build=$(ls -d *.xcodeproj | head -1)
        else
          echo "âŒ No .xcworkspace or .xcodeproj found"
          exit 1
        fi

        echo "Building $file_to_build..."

        xcodebuild clean build -"$filetype_parameter" "$file_to_build" -scheme "$SCHEME_NAME" -destination 'platform=iOS Simulator,name=iPhone 17,OS=latest' -skipPackagePluginValidation -skipMacroValidation
    
#    - name: Run tests ğŸ§ª
#      run: |
#        cd "$PROJECT_DIR"
#        xcodebuild test -project "$SCHEME_NAME.xcodeproj" -scheme "$SCHEME_NAME" -destination 'platform=iOS Simulator,name=iPhone 17,OS=latest' -skipPackagePluginValidation -skipMacroValidation
