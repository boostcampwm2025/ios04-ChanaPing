# GitHubÏùò Ïï°ÏÖò ÌÉ≠ÏóêÏÑú ÌëúÏãúÎêòÎäî ÏõåÌÅ¨ÌîåÎ°úÏö∞Ïùò Ïù¥Î¶Ñ
name: Build and Test

on:
  # develop Î∏åÎûúÏπòÏóê push ÎÇò pull request Ïù¥Î≤§Ìä∏Í∞Ä ÏùºÏñ¥ÎÇ¨ÏùÑÎïå Ìï¥Îãπ workflowÎ•º Ìä∏Î¶¨Í±∞
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]

jobs:
  build:
    runs-on: macos-15
    env:
      PROJECT_DIR: Meomun
      SCHEME_NAME: Meomun
    steps:
    # repository Ï≤¥ÌÅ¨ÏïÑÏõÉ(Ï†ÄÏû•ÏÜåÏùò ÏΩîÎìúÎ•º Ïã§Ìñâ ÌôòÍ≤ΩÏúºÎ°ú Í∞ÄÏ†∏Ïò¥)
    - uses: actions/checkout@v4
    
    # Ìï¥Îãπ Í∞ÄÏÉÅ Î®∏Ïã† ÌôòÍ≤ΩÏóêÏÑúÏùò Í∞ÄÏö© Xcode Î≤ÑÏ†ÑÏùÑ Ï∂úÎ†•
    - name: List available Xcode versions
      run: ls /Applications | grep Xcode

    # ÌòÑÏû¨ Xcode Î≤ÑÏ†Ñ Ï∂úÎ†•
    - name: Show current version of Xcode
      run: xcodebuild -version

    # Xcode Î≤ÑÏ†Ñ ÏßÅÏ†ë ÏÑ§Ï†ï ÌõÑ ÌôïÏù∏
    - name: Set up Xcode version
      run: |
        sudo xcode-select -s /Applications/Xcode_26.1.app/Contents/Developer
        xcodebuild -version

    - name: Build the project üõ†
      run: |
        # ÌîÑÎ°úÏ†ùÌä∏ ÎîîÎ†âÌÜ†Î¶¨Î°ú Ïù¥Îèô
        cd "$PROJECT_DIR"
        
        # .xcworkspace ÎòêÎäî .xcodeproj ÌååÏùº Ï∞æÍ∏∞
        if [ -d *.xcworkspace ] 2>/dev/null; then
          filetype_parameter="workspace"
          file_to_build=$(ls -d *.xcworkspace | head -1)
        elif [ -d *.xcodeproj ] 2>/dev/null; then
          filetype_parameter="project"
          file_to_build=$(ls -d *.xcodeproj | head -1)
        else
          echo "‚ùå No .xcworkspace or .xcodeproj found"
          exit 1
        fi

        echo "Building $file_to_build..."

        xcodebuild clean build -"$filetype_parameter" "$file_to_build" -scheme "$SCHEME_NAME" -destination 'platform=iOS Simulator,name=iPhone 17,OS=latest' -skipPackagePluginValidation -skipMacroValidation
    
#    - name: Run tests üß™
#      run: |
#        cd "$PROJECT_DIR"
#        xcodebuild test -project "$SCHEME_NAME.xcodeproj" -scheme "$SCHEME_NAME" -destination 'platform=iOS Simulator,name=iPhone 17,OS=latest' -skipPackagePluginValidation -skipMacroValidation
